(function(e){e.fn.goTo=function(){return e("html, body").animate({scrollTop:e(this).offset().top+"px"},"fast"),this}})(jQuery),$(document).ready(function(){var e=0;setInterval(function(){var a=12,t=16,s=e*-t;$(".ajax-spinner").css({backgroundPosition:s+"px 0px"}),e++,e>=a&&(e=0)},100),$(".modal form").submit(function(e){e.preventDefault()}),$(".modal").click(function(e){$(this).hasClass("modal-busy")||!$(e.target).is(".modal")&&!$(e.target).is(".modal-close")||$(this).removeClass("modal-active")}),$(".login-nav-btn").click(function(){$("#myModal").modal("show"),$("#modal-login").addClass("selected").siblings().removeClass("selected"),$(".modal-login-content").show().siblings().hide()}),$(".register-nav-btn").click(function(){$("#myModal").modal("show"),$("#modal-register").addClass("selected").siblings().removeClass("selected"),$(".modal-register-content").show().siblings().hide()}),$(".forgotpassword-nav-btn").click(function(){$(".modal-auth").hasClass("modal-busy")||$(".modal-forgotpass-content").show().siblings().hide()}),$("#modal-login").click(function(){$(".modal-auth").hasClass("modal-busy")||($(this).addClass("selected").siblings().removeClass("selected"),$(".modal-login-content").show().siblings().hide())}),$("#modal-register").click(function(){$(".modal-auth").hasClass("modal-busy")||($(this).addClass("selected").siblings().removeClass("selected"),$(".modal-register-content").show().siblings().hide())}),$(".modal-login-content input").keydown(function(e){13==e.keyCode&&$(".modal-login-content button").trigger("click")}),$(".modal-login-content button").click(function(){$(".modal-auth").addClass("modal-busy"),$(".modal-login-content .error-msg").text(""),$(".modal-loading-content").show().siblings().hide();var e={username:$(".modal-login-content input[name='username']").val(),password:$(".modal-login-content input[name='password']").val()};$.ajax({url:"/pelis/ajax/login",data:e,type:"POST",success:function(e){"ok"==e.status?window.location.reload():($(".modal-auth").removeClass("modal-busy"),$(".modal-login-content input[name='password']").val(""),$(".modal-login-content .error-msg").text("Error: "+e.message),$(".modal-login-content").show().siblings().hide())},error:function(e){0==e.status&&(e.statusText="Page did not respond"),$(".modal-auth").removeClass("modal-busy"),$(".modal-login-content input[name='password']").val(""),$(".modal-login-content .error-msg").text("Error: "+e.statusText+" (Code "+e.status+")"),$(".modal-login-content").show().siblings().hide()}})}),$(".modal-register-content input").keydown(function(e){13==e.keyCode&&$(".modal-register-content button").trigger("click")}),$(".modal-register-content button").click(function(){$(".modal-auth").addClass("modal-busy"),$(".modal-register-content .error-msg").text(""),$(".modal-loading-content").show().siblings().hide();var e={firstname:$(".modal-register-content input[name='firstname']").val(),lastname:$(".modal-register-content input[name='lastname']").val(),username:$(".modal-register-content input[name='username']").val(),email:$(".modal-register-content input[name='email']").val(),password:$(".modal-register-content input[name='password']").val(),password_confirmation:$(".modal-register-content input[name='password_confirmation']").val()};$.ajax({url:"/pelis/ajax/register",data:e,type:"POST",success:function(e){"ok"==e.status?($(location).attr("href",""),$(".modal-auth").removeClass("modal-busy"),$(".modal-register-content input[name='firstname']").val(""),$(".modal-register-content input[name='lastname']").val(""),$(".modal-register-content input[name='username']").val(""),$(".modal-register-content input[name='email']").val(""),$(".modal-register-content input[name='password']").val(""),$(".modal-register-content input[name='password_confirmation']").val(""),$(".modal-activate-account-content").show().siblings().hide()):($(".modal-auth").removeClass("modal-busy"),$(".modal-register-content input[name='password']").val(""),$(".modal-register-content input[name='password_confirmation']").val(""),$(".modal-register-content .error-msg").text("Error: "+e.message),$(".modal-register-content").show().siblings().hide())},error:function(e){$(".modal-auth").removeClass("modal-busy"),$(".modal-register-content input[name='password']").val(""),$(".modal-register-content input[name='password_confirmation']").val(""),$(".modal-register-content .error-msg").text("Error: "+e.statusText+" (Code "+e.status+")"),$(".modal-register-content").show().siblings().hide()}})}),$(".modal-forgotpass-content input").keydown(function(e){13==e.keyCode&&$(".modal-forgotpass-content button").trigger("click")}),$(".modal-forgotpass-content button").click(function(){$(".modal-auth").addClass("modal-busy"),$(".modal-forgotpass-content .error-msg").text(""),$(".modal-loading-content").show().siblings().hide();var e={email:$(".modal-forgotpass-content input[name='email']").val()};$.ajax({url:"/pelis/ajax/forgot-password",data:e,type:"POST",success:function(e){"ok"==e.status?window.location.reload():($(".modal-auth").removeClass("modal-busy"),$(".modal-forgotpass-content .error-msg").text("Error: "+e.message),$(".modal-forgotpass-content").show().siblings().hide())},error:function(e){$(".modal-auth").removeClass("modal-busy"),$(".modal-forgotpass-content .error-msg").text("Error: "+e.statusText+" (Code "+e.status+")"),$(".modal-forgotpass-content").show().siblings().hide()}})}),$("#mobile-search-btn").click(function(){$(window).scrollTop()>25?$("html, body").animate({scrollTop:0},"slow",function(){$("#mobile-search-input").is(":visible")||$("#mobile-search-input").delay(150).slideDown("fast")}):$("#mobile-search-input").is(":visible")?$("#mobile-search-input").slideUp("fast"):$("#mobile-search-input").slideDown("fast")}),$("#quick-search-input").click(function(){$(".ac-results").css({left:$("#quick-search").position().left+14,width:$("#quick-search").width()-4})});var a=$("#quick-search-input").val();$("#quick-search-input").focus(function(){$("#quick-search-input").val()==a?$("#quick-search-input").val(""):$("#quick-search-input").val().length>2&&$(".ac-results ul").not(":empty")&&$(".ac-results").slideDown(),$(".ac-results").css({left:$("#quick-search").position().left+14,width:$("#quick-search").width()-4})}),$("#quick-search-input").blur(function(){""===$("#quick-search-input").val().trim()&&$("#quick-search-input").val(a)});var t=function(){var e=0;return function(a,t){clearTimeout(e),e=setTimeout(a,t)}}();$("#quick-search-input").keyup(function(e){var a=e.keyCode||e.which,s={up:38,down:40,left:37,right:39,esc:27,enter:13};if(a===s.enter||a===s.esc||a===s.up||a===s.down||a===s.left||a===s.right)return!1;var i=$("#quick-search-input").val();i.length>=3&&t(function(){$(".ajax-spinner").fadeIn("fast"),$.ajax({url:"/pelis/ajax/search",data:{term:i},type:"GET",success:function(e){var a="";"ok"===e.status?e.data.forEach(function(e){a+='<li><a href="'+e.url+'"><img src="'+e.img+'"><span>'+e.title+"</span><p>"+e.year+"</p></a></li>"}):a='<li class="ac-no-results">'+e.message+"</li>",$(".ac-results ul").html(a),$(".ac-results").is(":visible")||$(".ac-results").slideDown(),$(".ac-results ul li:first-child").addClass("ac-item-selected"),$(".ajax-spinner").fadeOut("fast")},error:function(e){var a="";a='<li class="ac-no-results">Error: '+e.statusText+" (Code "+e.status+")</li>",$(".ac-results ul").html(a),$(".ac-results").not(":visible")&&$(".ac-results").slideDown(),$(".ac-results ul li:first-child").addClass("ac-item-selected"),$(".ajax-spinner").fadeOut("fast")}})},500)}),$(document).keydown(function(e){if($(".ac-results").is(":visible")){var a=e.keyCode||e.which,t={up:38,down:40,esc:27,enter:13};if(a===t.esc)return $(".ac-results").slideUp(),!1;if(!$(".ac-results li").hasClass("ac-no-results")){var s=$(".ac-results"),i=$(".ac-results ul li").hasClass("ac-item-selected"),n=$(".ac-results ul li").first().hasClass("ac-item-selected"),o=$(".ac-results ul li").last().hasClass("ac-item-selected");switch(a){case t.up:if(i){if(n){$("li.ac-item-selected",s).removeClass("ac-item-selected"),$("ul li",s).last().addClass("ac-item-selected");break}$("li.ac-item-selected",s).prev().addClass("ac-item-selected"),$("li.ac-item-selected",s).next().removeClass("ac-item-selected")}else $("ul li",s).last().addClass("ac-item-selected");break;case t.down:if(i){if(o){$("li.ac-item-selected",s).removeClass("ac-item-selected"),$("ul li",s).first().addClass("ac-item-selected");break}$("li.ac-item-selected",s).next().addClass("ac-item-selected"),$("li.ac-item-selected",s).prev().removeClass("ac-item-selected")}else $("ul li",s).first().addClass("ac-item-selected");break;case t.enter:window.location.href=$("li.ac-item-selected a",s).attr("href")}}}}),$(document).click(function(e){var a=$(e.target);$(".ac-results").is(":visible")&&0 in a&&"quick-search-input"!=a[0].id&&"a"!==e.target.tagName.toLowerCase()&&$(".ac-results").slideUp()}),$(".ac-results ul").on("mouseover","li",function(){$(this).addClass("ac-item-selected").siblings().removeClass("ac-item-selected")}),$(".star-row").click(function(e){var a=e.target.id,t=$("#movie-info").data("movie-id");if(a>0&&a<6&&t>0){var s={stars:a,id:t};$.ajax({url:"/pelis/ajax/star",data:s,type:"POST",success:function(e){"ok"==e.status&&($("#rating-span").text(e.data.avg),$(".star-row").find("span").each(function(e,t){t.id<=a?$(this).css("color","#BBD41C"):t.id>a&&$(this).css("color","")}))},error:function(e){}})}}),$("#comment-form").keydown(function(e){var a=e.keyCode||e.which,t={esc:27,enter:13};if(a!==t.enter)return 1;var s=$("#movie-info").data("movie-id"),i=$("#comment-form").val();if(i.length>=5){var n={comment:i,id:s};$.ajax({url:"/pelis/ajax/comment",data:n,type:"POST",success:function(e){if("ok"==e.status){var a=e.data.id,t=e.data.username,s=e.data.comment,i=e.data.time,n=e.data.stars,o=$(".comment-list > article").length;$(".comment-list #"+a).remove(),$("#comment-form").remove(),$(".comment-list").append('                                         <article id="'+a+'" class="row">                                              <div class="col-md-10 col-sm-10">                                              <div class="panel panel-default arrow '+(o%2?"left":"right")+'">                                                 <div class="panel-body">                                                     <header class="text-left">                                                         <div class="comment-user"><span class="glyphicon glyphicon-user"></span> '+t+"</div> "+(n>0?'<div class="comment-star"><span class="glyphicon glyphicon-star"></span> '+n+"</div>":"")+'<div class="comment-date"><span class="glyphicon glyphicon-time"></span> '+i+'</div>                                                     </header>                                                 <div class="comment-post">                                                     <p>'+s+"</p>                                                 </div>                                                 </div>                                             </div>                                             </div>                                         </article>")}},error:function(e){}})}e.preventDefault()}),$(".btn.btn-success.btn-film.btn-add").click(function(e){$("#modaladdmovie").modal("show")});var s;$(".image-preview-input input:file").change(function(){s=this.files[0],$(".image-filename").val(s.name)}),$(".btn.btn-danger.btn-film").click(function(e){var a=$(this).parent().parent(),t=e.target;if(t.id>0){var s={action:"delfilm",id:t.id};$.ajax({url:"/pelis/ajax/admin",type:"POST",data:s,success:function(e){"ok"==e.status&&a.remove()},error:function(e){}})}}),$(".btn.btn-primary.btn-add").click(function(e){var a=$("#addname").val(),t=$("#addyear").val(),i=$("#addgene").val(),n=$("#addsinop").val();if(null==s)return!1;var o=new FormData;o.append("action","addfilm"),o.append("name",a),o.append("year",t),o.append("generoid",i),o.append("sinopsis",n),o.append("image",s),$.ajax({url:"/pelis/ajax/admin",type:"POST",data:o,cache:!1,processData:!1,contentType:!1,success:function(e){if("ok"==e.status){var s=e.data.id;$("#list-film").append('<li class="list-group-item clearfix">                         <span class="label label-default">'+s+'</span>                         <span class="film-info">'+a+" ("+t+')</span>                         <span class="film-edit"></span>                         <span class="pull-right button-group">                             <a id="'+s+'" href="javascript:void(0)" class="btn btn-primary btn-film btn-edit"><span class="glyphicon glyphicon-edit"></span> Edit</a>                             <a id="'+s+'" href="javascript:void(0)" class="btn btn-danger btn-film"><span class="glyphicon glyphicon-remove"></span> Delete</a>                         </span>                         <div class="edit-space"></div>                     </li>'),$("#"+s).goTo(),$("#modaladdmovie").modal("hide")}},error:function(e){}})}),$(".btn.btn-primary.btn-film").click(function(e){var a=$(this).parent().parent();e.target;$(this).hasClass("btn-edit")?($(this).removeClass("btn-edit"),$(this).addClass("btn-accept"),$(this).html('<span class="glyphicon glyphicon-ok"></span> Accept'),$(a).find(".film-info").hide(),$(a).find(".film-edit").html('<div class="input-group"><span class="input-group-addon" id="basic-addon1">@</span><input type="text" class="form-control" placeholder="Username" aria-describedby="basic-addon1"></div>'),$(a).find(".film-edit").show()):($(this).removeClass("btn-accept"),$(this).addClass("btn-edit"),$(a).find(".film-edit").hide(),$(this).html('<span class="glyphicon glyphicon-edit"></span> Edit'),$(a).find(".film-info").show())})});